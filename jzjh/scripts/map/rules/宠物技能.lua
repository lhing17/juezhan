---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by G_Seinfeld.
--- DateTime: 2018/11/15 21:40
---

--鸟的贩卖技能

--切换物品
function IsQieHuanItem()
    return GetSpellAbilityId() == 1093677133 and he[1 + GetPlayerId(GetOwningPlayer(GetTriggerUnit()))] == false
end
function QieHuanItem()
    UnitAddItem(Vs, UnitItemInSlotBJ(GetTriggerUnit(), 1))
    UnitAddItem(GetTriggerUnit(), UnitItemInSlotBJ(udg_hero[1 + GetPlayerId(GetOwningPlayer(GetTriggerUnit()))], 1))
    UnitAddItem(udg_hero[1 + GetPlayerId(GetOwningPlayer(GetTriggerUnit()))], UnitItemInSlotBJ(Vs, 1))
end

local function init()
    -- 切换背包
    et.game:event '单位-施放技能' (function(self, u, id, target)
        if id == 1093677134 then
            local p = u:get_owner()
            for i = 1, 6 do
                b7[p.id]:add_item(C7[p.id]:get_item_in_slot(i))
            end
            for i = 1, 6 do
                C7[p.id]:add_item(u:get_item_in_slot(i))
            end
            for i = 1, 6 do
                u[p.id]:add_item(b7[p.id]:get_item_in_slot(i))
            end
        end
    end)

    -- 鸟的贩卖技能
    et.game:event '单位-技能生效' (function(self, u, id, target)
        if id == 1093679433 then
            local p = u:get_owner()
            local last = p:create_unit(1853257068, et.get_rect_center(Ge))
            last:show(false)
            last:add_item(target)
            jass.UnitDropItemTarget(last.handle, last:get_item_in_slot(1), Rs.handle)
            PlaySoundOnUnitBJ(Ih, 100, u.handle)
            jass.DestroyEffect(jass.AddSpecialEffectTarget("Abilities\\Spells\\Items\\ResourceItems\\ResourceEffectTarget.mdl", u.handle, "overhead"))
        end
    end)


    -- 切换物品
    tj = CreateTrigger()
    TriggerRegisterAnyUnitEventBJ(tj, EVENT_PLAYER_UNIT_SPELL_CAST)
    TriggerAddCondition(tj, Condition(IsQieHuanItem))
    TriggerAddAction(tj, QieHuanItem)
end
init()