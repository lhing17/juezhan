---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by G_Seinfeld.
--- DateTime: 2018/11/15 21:34
---
--------轻功系统------//
local function init()
    -- 轻功系统
    et.game:event '单位-技能生效'(function(self, u, id, target)
        if id == 1093677653 and u:is_hero() then
            local p1 = u:get_point()
            local p2 = target
            local agi = jass.GetHeroAgi(u.handle, false)
            local angle = p1 / p2
            local distance = 500 + jass.GetHeroStr(u.handle, false) / 3
            local velocity = 48.027 * agi ^ 0.3131
            velocity = velocity >= 1000 and 1000 or velocity
            distance = distance >= 2000 and 2000 or distance
            distance = p1 * p2
            local last_time = distance / velocity
            u:set_facing(angle)
            local eff = et.effect.add_to_unit("Abilities\\Weapons\\PhoenixMissile\\Phoenix_Missile.mdl", u, 'origin')
            u:set_animation('walk')
            YDWEJumpTimer(u.handle, angle, distance, last_time, 0.03, 100)
            et.wait(last_time * 1000, function()
                eff:destory()
            end)

        end

    end)
end
init()