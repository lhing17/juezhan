---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by G_Seinfeld.
--- DateTime: 2018/12/17 14:02
---

--- @param source unit
--- @param target unit
--- @param damage number
et.game:event '单位-受到伤害'(function(self, source, target, damage)
    if damage ~= 0.15 or not source:get_owner():is_player() then
        return
    end
    local coeff = 1
    coeff = coeff + (source:has_ability(1395666992) and 0.4 or 0)
    coeff = coeff + (source:has_ability(1093678897) and 0.8 or 0)
    coeff = coeff + (source:has_ability(1093678931) and 0.7 or 0)
    coeff = coeff * (source:has_item(1227899212) and 3 or 1)
    local ability_damage, critical = damage_formula {
        source = source,
        target = target,
        magic_coeff = 1,
        physic_coeff = 3,
        ability_coeff = 10 * coeff,
        level = source:get_ability_level(1093678407)
    }
    apply_damage(source, target, ability_damage, critical)
    if source:has_ability(1093678932) then
        et.effect.add_to_point("war3mapImported\\ShadowBurn.mdx", target:get_point()):destroy()
        local group = et.selector():in_range(target:get_point(), 100):is_enemy(source):get()
        for _, v in pairs(group) do
            ability_damage, critical = damage_formula {
                source = source,
                target = v,
                magic_coeff = 1.1,
                physic_coeff = 1,
                ability_coeff = 60 * coeff,
                level = source:get_ability_level(1093678407)
            }
            apply_damage(source, v, ability_damage, critical)
        end
    end
end)

--- @param u unit
--- @param id number
--- @param target nil
et.game:event '单位-技能生效'(function(self, u, id, target)
    if not id == 1093677104 then
        return
    end
    if u:has_ability(1093678415) then
        dummy_issue_order {
            target = u,
            player = u:get_owner(),
            ability_id = 1093678408,
            order_id = 852066,
            lifetime = 2
        }
    end
    if u:has_ability(1093682254) then
        local last = u:get_owner():create_unit(1697656881, u:get_point())
        last:set_lifetime(12)
    end
    if u:has_ability(1093678933) and u:has_ability(1093678918) then
        dummy_issue_order {
            target = u:get_point() - {90, 256},
            player = u:get_owner(),
            ability_id = 1093678410,
            order_id = 852593,
            lifetime = 6
        }
    end
end)


