---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by G_Seinfeld.
--- DateTime: 2018/12/17 14:05
---

--金钟罩
function Cc()
    return GetSpellAbilityId() == 1093678415 and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) ~= nil -- INLINED!!
end
function cc()
    local u = GetTriggerUnit()
    local p = GetOwningPlayer(u)
    local i = 1 + GetPlayerId(p)
    DestroyEffect(E7[i])
    UnitRemoveAbility(u, 1110454320)
    D7[i] = 5000.0 * I2R(yishu[i]) * I2R(GetUnitAbilityLevel(u, 1093678415))
    ce[i] = 70 * GetUnitAbilityLevel(u, 1093678415)
    YDWEGeneralBounsSystemUnitSetBonus(u, 2, 0, 70 * GetUnitAbilityLevel(u, 1093678415))
    if gengu[i] >= 20 then
        D7[i] = D7[i] * 2.0
    end
    AddSpecialEffectTargetUnitBJ("chest", u, "war3mapImported\\DefensiveBarrierBig.mdx")
    DisplayTextToPlayer(GetOwningPlayer(u), 0, 0, "|cff00ccff金钟罩效果总值：" .. (I2S(R2I(D7[i])) or ""))
    E7[i] = bj_lastCreatedEffect
    WuGongShengChong(u, 1093678415, 100.0)
    u = nil
    p = nil
end
function Ec()
    return UnitHasBuffBJ(GetTriggerUnit(), 1110454320)
end
function Fc()
    return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetTriggerUnit())) and IsUnitAliveBJ(GetFilterUnit())
end
function Gc()
    local u = GetTriggerUnit()
    local uc = GetEnumUnit()
    local loc = GetUnitLoc(uc)
    local shxishu = 1.0
    local shanghai = 0.0
    if UnitHaveItem(u, 1227899212) then
        shxishu = shxishu * 8
    end
    AddSpecialEffectLocBJ(loc, "Abilities\\Spells\\Undead\\DarkRitual\\DarkRitualTarget.mdl")
    DestroyEffect(bj_lastCreatedEffect)
    RemoveLocation(loc)
    shanghai = ShangHaiGongShi(u, uc, 400, 400, shxishu, 1093678415)
    WuGongShangHai(u, uc, shanghai)
    u = nil
    uc = nil
    loc = nil
end
function Hc()
    local u = GetTriggerUnit()
    local uc = GetEventDamageSource()
    local shxishu = 1.0
    local shanghai = 0.0
    local p = GetOwningPlayer(u)
    local i = 1 + GetPlayerId(p)
    local loc = GetUnitLoc(u)
    local loc2 = GetUnitLoc(uc)
    if UnitHaveItem(u, 1227899212) then
        shxishu = shxishu * 8
    end
    if GetEventDamage() <= D7[i] then
        D7[i] = D7[i] - GetEventDamage()
        SetWidgetLife(u, GetUnitStateSwap(UNIT_STATE_LIFE, GetTriggerUnit()) + GetEventDamage())
        --+化功大法
        if GetUnitAbilityLevel(u, 1093678928) ~= 0 then
            AddSpecialEffectLocBJ(loc2, "Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl")
            DestroyEffect(bj_lastCreatedEffect)
            RemoveLocation(loc2)
            shanghai = ShangHaiGongShi(u, uc, 20.0, 20.0, shxishu, 1093678415)
            WuGongShangHai(u, uc, shanghai)
        end
    else
        DestroyEffect(E7[i])
        YDWEGeneralBounsSystemUnitSetBonus(GetTriggerUnit(), 2, 1, ce[i])
        --+易筋经
        if GetUnitAbilityLevel(u, 1093679428) ~= 0 then
            ForGroupBJ(YDWEGetUnitsInRangeOfLocMatchingNull(600.0, loc, Condition(Fc)), Gc)
        end
        --+小无相
        if GetUnitAbilityLevel(u, 1093679155) ~= 0 and GetRandomReal(0, 100.0) >= 70.0 then
            D7[i] = 2500.0 * I2R(yishu[i]) * I2R(GetUnitAbilityLevel(u, 1093678415))
            ce[i] = 70 * GetUnitAbilityLevel(u, 1093678415)
            YDWEGeneralBounsSystemUnitSetBonus(GetTriggerUnit(), 2, 0, 70 * GetUnitAbilityLevel(u, 1093678415))
            if gengu[1 + GetPlayerId(GetOwningPlayer(u))] >= 20 then
                D7[i] = D7[i] * 2.0
            end
            AddSpecialEffectTargetUnitBJ("chest", GetTriggerUnit(), "war3mapImported\\DefensiveBarrierBig.mdx")
            DisplayTextToPlayer(p, 0, 0, "|cff00ccff小无相重启金钟罩，效果总值：" .. (I2S(R2I(D7[i])) or ""))
            E7[i] = bj_lastCreatedEffect
        else
            UnitRemoveAbility(GetTriggerUnit(), 1110454320)
        end
    end
    RemoveLocation(loc)
    u = nil
    uc = nil
    p = nil
    loc = nil
    loc2 = nil
end

t = CreateTrigger()
TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
TriggerAddCondition(t, Condition(Cc))
TriggerAddAction(t, cc)

--t = CreateTrigger()
--YDWESyStemAnyUnitDamagedRegistTrigger(t)
--TriggerAddCondition(t, Condition(Ec))
--TriggerAddAction(t, Hc)