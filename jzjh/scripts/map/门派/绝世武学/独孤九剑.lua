---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by G_Seinfeld.
--- DateTime: 2018/12/23 0023 21:29
---

--独孤九剑
function IsDuGuJiuJian()
    return GetSpellAbilityId() == 1093678918 and IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) ~= nil -- INLINED!!
end
function DuGuJiuJian()
    local u = GetTriggerUnit()
    local p = GetOwningPlayer(u)
    GroupAddUnit(k9, u)
    m9 = 0.0
    n9 = 0.0
    o9[0] = GetUnitLoc(u)
    p9 = 1
    for _ in _loop_() do
        if p9 > 20 then break end
        m9 = m9 + 18.0
        o9[1] = pu(o9[0], 300.0, I2R(p9) * 28.0)
        CreateNUnitsAtLoc(1, 1747988531, p, o9[1], bj_UNIT_FACING)
        q9[p9] = bj_lastCreatedUnit
        RemoveLocation(o9[1])
        SetUnitAnimation(q9[p9], "birth")
        SetUnitFlyHeight(q9[p9], m9, 100.0)
        p9 = p9 + 1
    end
    RemoveLocation(o9[0])
    WuGongShengChong(GetTriggerUnit(), 1093678918, 120.0)
    YDWEPolledWaitNull(10.0)
    GroupRemoveUnit(k9, u)
    u = nil
    p = nil
end
function mG()
    return CountUnitsInGroup(k9) > 0
end
function nG()
    local id = GetHandleId(GetTriggeringTrigger())
    return IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227))) and IsUnitAliveBJ(GetFilterUnit())
end
function oG()
    local u = LoadUnitHandle(YDHT, GetHandleId(GetTriggeringTrigger()) * LoadInteger(YDHT, GetHandleId(GetTriggeringTrigger()), -320330265), 1505665227)
    local uc = GetEnumUnit()
    local i = 1 + GetPlayerId(GetOwningPlayer(u))
    local shxishu = jueXueXiShu(i)
    local shanghai = 0.0
    shanghai = ShangHaiGongShi(u, uc, 9.0, 9.0, shxishu, 1093678918)
    WuGongShangHai(u, uc, shanghai)
    u = nil
    uc = nil
end
function pG()
    local id = GetHandleId(GetTriggeringTrigger())
    if IsUnitDeadBJ(GetEnumUnit()) then
    else
        SaveUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227, GetEnumUnit())
        SaveLocationHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), -1925439584, GetUnitLoc(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227)))
        n9 = n9 + 12.0
        p9 = 1
        for _ in _loop_() do
            if p9 > 48 then break end
            o9[2] = pu(LoadLocationHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), -1925439584), 300.0, I2R(p9) * 16.0 + n9)
            SetUnitPositionLoc(q9[p9], o9[2])
            RemoveLocation(o9[2])
            p9 = p9 + 1
        end
        SaveInteger(YDHT, id * LoadInteger(YDHT, id, -320330265), -708948899, 1093678918)
        SaveReal(YDHT, id * LoadInteger(YDHT, id, -320330265), -753873030, 1.0 + I2R(juexuelingwu[1 + GetPlayerId(GetOwningPlayer(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227)))]) + I2R(GetUnitAbilityLevel(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227), LoadInteger(YDHT, id * LoadInteger(YDHT, id, -320330265), -708948899))) / 2.0 + I2R(wuxing[1 + GetPlayerId(GetOwningPlayer(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227)))]) * 0.06)
        SaveReal(YDHT, id * LoadInteger(YDHT, id, -320330265), 426308609, 0.2 + udg_shanghaijiacheng[1 + GetPlayerId(GetOwningPlayer(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227)))])
        SaveReal(YDHT, id * LoadInteger(YDHT, id, -320330265), -753873030, LoadReal(YDHT, id * LoadInteger(YDHT, id, -320330265), -753873030) * LoadReal(YDHT, id * LoadInteger(YDHT, id, -320330265), 426308609))
        if GetUnitAbilityLevel(LoadUnitHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), 1505665227), LoadInteger(YDHT, id * LoadInteger(YDHT, id, -320330265), -708948899)) == 9 then
            SaveReal(YDHT, id * LoadInteger(YDHT, id, -320330265), -753873030, LoadReal(YDHT, id * LoadInteger(YDHT, id, -320330265), -753873030) * 10.0)
        end
        ForGroupBJ(YDWEGetUnitsInRangeOfLocMatchingNull(450.0, LoadLocationHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), -1925439584), Condition(nG)), oG)
        RemoveLocation(LoadLocationHandle(YDHT, id * LoadInteger(YDHT, id, -320330265), -1925439584))
        YDWELocalVariableEnd()
    end
end
function qG()
    local id = GetHandleId(GetTriggeringTrigger())
    local cx = LoadInteger(YDHT, id, -807506826)
    cx = cx + 3
    SaveInteger(YDHT, id, -807506826, cx)
    SaveInteger(YDHT, id, -320330265, cx)
    YDWELocalVariableInitiliation()
    ForGroupBJ(k9, pG)
    FlushChildHashtable(YDHT, id * cx)
end

t = CreateTrigger()
TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
TriggerAddCondition(t, Condition(IsDuGuJiuJian))
TriggerAddAction(t, DuGuJiuJian)
t = CreateTrigger()
TriggerRegisterTimerEventPeriodic(t, 0.03)
TriggerAddCondition(t, Condition(mG))
TriggerAddAction(t, qG)